import{_ as B,u as L,g as N,r as u,o as V,a as M,c as p,b as d,d as o,e as t,w as a,f as i,h as R,i as b,j as q,l as S,k as A,m as K,n as x,p as P,t as U,q as j,s as D,v as g,x as E}from"./index-BNZe5Fbc.js";const G={class:"login-container"},$={class:"login-box glass"},F={class:"logo-section"},H={class:"qr-section"},J={key:0,class:"loading"},O={key:1,class:"qr-wrapper"},W={class:"qr-container"},X=["src"],Y={key:0,class:"qr-expired"},Z={class:"qr-tip"},ee={__name:"Login",setup(se){const C=E(),k=L(),{proxy:z}=N(),l=z.$toast,y=u(""),m=u(""),c=u("请使用网易云音乐APP扫码登录"),r=u(!1),f=u(!1);let _=null;const w=async()=>{try{r.value=!0,f.value=!1;const e=await g.getQrKey();m.value=e.data.unikey;const s=await g.createQr(m.value);y.value=s.data.qrimg,r.value=!1,I()}catch(e){console.error("获取二维码失败:",e),l.error("获取二维码失败，请刷新重试"),r.value=!1}},I=()=>{_=setInterval(async()=>{try{const e=await g.checkQr(m.value);if(console.log("二维码状态:",e),e.code===800)c.value="二维码已过期，请刷新",f.value=!0,v();else if(e.code===801)c.value="等待扫码...";else if(e.code===802)c.value="扫码成功，请在手机上确认";else if(e.code===803){c.value="登录成功，正在跳转...",v();try{e.cookie&&(document.cookie=e.cookie),await k.login(e.cookie||""),k.isLoggedIn?(l.success("登录成功"),setTimeout(()=>{C.push("/discover")},500)):(l.error("登录失败，请重试"),h())}catch(s){console.error("登录处理失败:",s),l.error("登录失败，请重试"),h()}}}catch(e){console.error("检查二维码状态失败:",e)}},2e3)},v=()=>{_&&(clearInterval(_),_=null)},h=()=>{w()},T=async()=>{try{r.value=!0,v();const e=await g.loginAnonymous();e.code===200?(e.cookie&&(document.cookie=e.cookie),k.setGuestMode(),l.success("游客登录成功"),setTimeout(()=>{C.push("/discover")},500)):l.error("游客登录失败")}catch(e){console.error("游客登录失败:",e),l.error("游客登录失败，请重试")}finally{r.value=!1}};return V(()=>{w()}),M(()=>{v()}),(e,s)=>{const n=b("el-icon"),Q=b("el-button");return d(),p("div",G,[o("div",$,[o("div",F,[t(n,{size:48,color:"#ec4141"},{default:a(()=>[t(i(R))]),_:1}),s[0]||(s[0]=o("h1",{class:"title"},"QianMusic",-1)),s[1]||(s[1]=o("p",{class:"subtitle"},"简洁 · 优雅 · 纯粹",-1))]),o("div",H,[s[5]||(s[5]=o("h2",{class:"section-title"},"扫码登录",-1)),r.value?(d(),p("div",J,[t(n,{class:"is-loading",size:40},{default:a(()=>[t(i(S))]),_:1}),s[2]||(s[2]=o("p",null,"加载中...",-1))])):y.value?(d(),p("div",O,[o("div",W,[o("img",{src:y.value,alt:"二维码",class:"qr-code"},null,8,X),f.value?(d(),p("div",Y,[t(n,{size:60},{default:a(()=>[t(i(K))]),_:1}),s[3]||(s[3]=o("p",null,"二维码已过期",-1))])):q("",!0)]),o("p",Z,[t(n,null,{default:a(()=>[t(i(P))]),_:1}),x(" "+U(c.value),1)]),f.value?(d(),A(Q,{key:0,onClick:h,type:"danger",round:"",size:"large"},{default:a(()=>[t(n,null,{default:a(()=>[t(i(j))]),_:1}),s[4]||(s[4]=x(" 刷新二维码 ",-1))]),_:1})):q("",!0)])):q("",!0)]),s[7]||(s[7]=o("div",{class:"divider"},[o("span",null,"或")],-1)),t(Q,{onClick:T,type:"info",plain:"",round:"",size:"large",class:"guest-btn"},{default:a(()=>[t(n,null,{default:a(()=>[t(i(D))]),_:1}),s[6]||(s[6]=x(" 游客登录 ",-1))]),_:1})])])}}},te=B(ee,[["__scopeId","data-v-d84ab647"]]);export{te as default};
