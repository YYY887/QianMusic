import{_ as Vt,y as It,u as Pt,g as Bt,r as u,o as Dt,c,b as i,d as t,e as d,j as y,w as C,i as _,n as h,t as o,I as U,F as G,E as Q,z as W,J as ct,B as Tt,K as Lt,T as $t,L as Ht,v as b,f as E,k as Nt}from"./index-BNZe5Fbc.js";const Ut={class:"playlist"},Ft={class:"container"},Rt={key:0,class:"loading"},jt={key:1,class:"playlist-content"},At={class:"playlist-header glass"},Et={class:"cover-section"},Jt={class:"cover-overlay"},Kt={class:"info-section"},Ot={class:"playlist-tag"},qt={class:"playlist-name"},Gt={class:"creator-info"},Qt={class:"creator-name"},Wt={class:"create-time"},Xt={key:0,class:"description"},Yt={class:"stats-row"},Zt={class:"stat-item"},ts={class:"stat-item"},ss={class:"stat-item"},es={class:"action-buttons"},os={class:"track-section"},as={class:"track-header"},ls={class:"track-title"},ns={class:"track-count"},is={class:"track-list glass"},cs=["onClick"],rs={class:"track-index"},ds={class:"index-number"},us={class:"track-main"},vs={class:"track-info"},ms={class:"track-name"},_s={class:"track-artist"},ps={class:"track-album"},hs={class:"track-duration"},ys={class:"drawer-header"},fs={class:"drawer-tabs"},gs={class:"drawer-body"},Cs={class:"tab-content"},bs={class:"comment-input-section"},ks={class:"comment-input-footer"},ws={class:"char-count"},xs=["disabled"],Ss={key:0},Ms={key:1,class:"spinner-small"},zs={key:0,class:"loading-comments"},Vs={key:1,class:"comments-list"},Is=["src"],Ps={class:"comment-content"},Bs={class:"comment-user"},Ds={class:"username"},Ts={class:"comment-time"},Ls={class:"comment-text"},$s={class:"comment-actions"},Hs={class:"action-btn-small"},Ns=["onClick"],Us=["onClick"],Fs={key:0,class:"empty-comments"},Rs={key:1,class:"load-more"},js=["disabled"],As={key:0},Es={key:1,class:"spinner-small"},Js={class:"tab-content"},Ks={class:"details-section"},Os={class:"detail-item"},qs={class:"detail-value"},Gs={class:"detail-item"},Qs={class:"detail-value creator-row"},Ws=["src"],Xs={class:"detail-item"},Ys={class:"detail-value"},Zs={class:"detail-item"},te={class:"detail-value"},se={class:"detail-item"},ee={class:"detail-value"},oe={class:"detail-item"},ae={class:"detail-value"},le={class:"detail-item"},ne={class:"detail-value"},ie={key:0,class:"detail-item"},ce={class:"detail-value description-text"},re={key:1,class:"detail-item"},de={class:"detail-value tags-row"},ue={__name:"Playlist",setup(ve){const k=Ht(),z=It(),rt=Pt(),{proxy:dt}=Bt(),m=dt.$toast,n=u(null),w=u([]),J=u(!0),F=u(!1),f=u("comments"),g=u([]),V=u(!1),M=u(0),K=u(!0),I=u("playlist"),P=u(null),ut=u(""),B=u(!1),x=u(""),R=u(!1),vt=async()=>{var e;try{J.value=!0;const s=k.params.id,[a,l]=await Promise.all([b.getPlaylistDetail(s),b.getPlaylistTrackAll(s)]);n.value=a.playlist,w.value=l.songs||[],B.value=((e=a.playlist)==null?void 0:e.subscribed)||!1}catch(s){console.error("获取歌单详情失败:",s)}finally{J.value=!1}},mt=e=>{z.playSong(e,w.value)},X=()=>{w.value.length>0&&z.playSong(w.value[0],w.value)},_t=()=>{I.value="playlist",P.value=k.params.id,ut.value="",F.value=!0,f.value!=="comments"&&(f.value="comments"),M.value=0,j()},pt=async()=>{var e,s;try{const a=!B.value,l=await b.subscribePlaylist(k.params.id,a);l.code===200?(B.value=a,m.success(a?"已收藏歌单":"已取消收藏")):l.code===405?m.warning("操作过于频繁，请稍后再试"):m.error(l.msg||"操作失败，请重试")}catch(a){console.error("收藏歌单失败:",a),((s=(e=a.response)==null?void 0:e.data)==null?void 0:s.code)===405?m.warning("操作过于频繁，请稍后再试"):m.error("操作失败，请重试")}},ht=e=>{const s=Math.floor(e/1e3),a=Math.floor(s/60),l=s%60;return`${a}:${l.toString().padStart(2,"0")}`},Y=e=>e>=1e8?(e/1e8).toFixed(1)+"亿":e>=1e4?(e/1e4).toFixed(1)+"万":e,O=e=>new Date(e).toLocaleDateString("zh-CN",{year:"numeric",month:"long",day:"numeric"}),yt=e=>{const a=Date.now()-e,l=60*1e3,p=60*l,S=24*p,q=30*S;return a<l?"刚刚":a<p?Math.floor(a/l)+"分钟前":a<S?Math.floor(a/p)+"小时前":a<q?Math.floor(a/S)+"天前":new Date(e).toLocaleDateString("zh-CN",{year:"numeric",month:"numeric",day:"numeric"})},j=async()=>{try{V.value=!0;const e=P.value||k.params.id;let s;I.value==="song"?s=await b.getSongComment(e,20,M.value):s=await b.getPlaylistComment(e,20,M.value),M.value===0?g.value=s.comments||[]:g.value=[...g.value,...s.comments||[]],K.value=s.more||!1}catch(e){console.error("获取评论失败:",e)}finally{V.value=!1}},ft=()=>{M.value+=20,j()},gt=async()=>{if(x.value.trim())try{R.value=!0;const e=P.value||k.params.id,s=I.value==="song"?0:2,a=await b.sendComment(s,e,x.value.trim());a.code===200?(m.success("评论成功"),x.value="",M.value=0,g.value=[],K.value=!0,setTimeout(async()=>{await j()},500)):m.error(a.message||"评论失败")}catch(e){console.error("发送评论失败:",e),m.error("评论失败，请重试")}finally{R.value=!1}},Ct=async e=>{try{const s=P.value||k.params.id,a=I.value==="song"?0:2,l=!e.liked;(await b.likeComment(a,s,e.commentId,l)).code===200&&(e.liked=l,e.likedCount=l?(e.likedCount||0)+1:Math.max((e.likedCount||0)-1,0))}catch(s){console.error("点赞评论失败:",s),m.error("操作失败，请重试")}},bt=async e=>{if(confirm("确定要删除这条评论吗？"))try{const s=P.value||k.params.id,a=I.value==="song"?0:2,l=await b.deleteComment(a,s,e.commentId);if(l.code===200){m.success("删除成功");const p=g.value.findIndex(S=>S.commentId===e.commentId);p>-1&&g.value.splice(p,1)}else m.error(l.message||"删除失败")}catch(s){console.error("删除评论失败:",s),m.error("删除失败，请重试")}};return Dt(()=>{vt(),j()}),(e,s)=>{var tt,st;const a=_("Loading"),l=_("el-icon"),p=_("el-image"),S=_("el-button"),q=_("Folder"),Z=_("el-avatar"),kt=_("Headset"),wt=_("Collection"),xt=_("ChatDotRound"),St=_("VideoPlay"),Mt=_("el-tag");return i(),c("div",Ut,[t("div",Ft,[J.value?(i(),c("div",Rt,[d(l,{class:"is-loading",size:50},{default:C(()=>[d(a)]),_:1}),s[6]||(s[6]=t("p",null,"加载中...",-1))])):n.value?(i(),c("div",jt,[t("div",At,[t("div",Et,[d(p,{src:n.value.coverImgUrl,fit:"cover",class:"cover"},null,8,["src"]),t("div",Jt,[d(S,{type:"danger",size:"large",circle:"",icon:e.VideoPlay,onClick:X,class:"play-all-float"},null,8,["icon"])])]),t("div",Kt,[t("div",Ot,[d(l,null,{default:C(()=>[d(q)]),_:1}),s[7]||(s[7]=h(" 歌单 ",-1))]),t("h1",qt,o(n.value.name),1),t("div",Gt,[d(Z,{size:32,src:(tt=n.value.creator)==null?void 0:tt.avatarUrl},null,8,["src"]),t("span",Qt,o((st=n.value.creator)==null?void 0:st.nickname),1),t("span",Wt,"创建于 "+o(O(n.value.createTime)),1)]),n.value.description?(i(),c("div",Xt,o(n.value.description),1)):y("",!0),t("div",Yt,[t("div",Zt,[d(l,null,{default:C(()=>[d(kt)]),_:1}),t("span",null,o(Y(n.value.playCount)),1)]),t("div",ts,[d(l,null,{default:C(()=>[d(wt)]),_:1}),t("span",null,o(n.value.subscribedCount),1)]),t("div",ss,[d(l,null,{default:C(()=>[d(xt)]),_:1}),t("span",null,o(n.value.commentCount),1)])]),t("div",es,[t("button",{class:"action-btn primary",onClick:X},[...s[8]||(s[8]=[t("svg",{viewBox:"0 0 24 24",width:"18",height:"18"},[t("path",{fill:"currentColor",d:"M8 5v14l11-7z"})],-1),h(" 播放全部 ",-1)])]),t("button",{class:U(["action-btn",{subscribed:B.value}]),onClick:pt},[s[9]||(s[9]=t("svg",{viewBox:"0 0 24 24",width:"18",height:"18"},[t("path",{fill:"currentColor",d:"M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"})],-1)),h(" "+o(B.value?"已收藏":"收藏"),1)],2),t("button",{class:"action-btn",onClick:_t},[...s[10]||(s[10]=[t("svg",{viewBox:"0 0 24 24",width:"18",height:"18"},[t("path",{fill:"currentColor",d:"M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2z"})],-1),h(" 评论 ",-1)])])])])]),t("div",os,[t("div",as,[t("h2",ls,[s[11]||(s[11]=h(" 歌曲列表 ",-1)),t("span",ns,"共 "+o(w.value.length)+" 首",1)])]),t("div",is,[(i(!0),c(G,null,Q(w.value,(v,A)=>{var D,T,L,$,H;return i(),c("div",{key:v.id,class:U(["track-item",{active:((D=E(z).currentSong)==null?void 0:D.id)===v.id,playing:((T=E(z).currentSong)==null?void 0:T.id)===v.id&&E(z).playing}]),onClick:N=>mt(v)},[t("div",rs,[t("span",ds,o(String(A+1).padStart(2,"0")),1),d(l,{class:"play-indicator"},{default:C(()=>[d(St)]),_:1})]),t("div",us,[d(p,{src:(L=v.al)==null?void 0:L.picUrl,fit:"cover",class:"track-cover",lazy:""},null,8,["src"]),t("div",vs,[t("div",ms,[h(o(v.name)+" ",1),v.fee===1?(i(),Nt(Mt,{key:0,size:"small",type:"danger",effect:"plain"},{default:C(()=>[...s[12]||(s[12]=[h("VIP",-1)])]),_:1})):y("",!0)]),t("div",_s,o(($=v.ar)==null?void 0:$.map(N=>N.name).join(" / ")),1)])]),t("div",ps,o((H=v.al)==null?void 0:H.name),1),t("div",hs,o(ht(v.dt)),1)],10,cs)}),128))])])])):y("",!0)]),d($t,{name:"drawer"},{default:C(()=>{var v,A,D,T,L,$,H,N,et,ot,at,lt,nt,it;return[F.value?(i(),c("div",{key:0,class:"drawer-overlay",onClick:s[5]||(s[5]=r=>F.value=!1)},[t("div",{class:"drawer-container",onClick:s[4]||(s[4]=Lt(()=>{},["stop"]))},[t("div",ys,[t("div",fs,[t("button",{class:U(["tab-btn",{active:f.value==="comments"}]),onClick:s[0]||(s[0]=r=>f.value="comments")}," 评论 ",2),t("button",{class:U(["tab-btn",{active:f.value==="details"}]),onClick:s[1]||(s[1]=r=>f.value="details")}," 详情 ",2)]),t("button",{class:"close-btn",onClick:s[2]||(s[2]=r=>F.value=!1)},[...s[13]||(s[13]=[t("svg",{viewBox:"0 0 24 24",width:"24",height:"24"},[t("path",{fill:"currentColor",d:"M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"})],-1)])])]),t("div",gs,[W(t("div",Cs,[t("div",bs,[W(t("textarea",{"onUpdate:modelValue":s[3]||(s[3]=r=>x.value=r),placeholder:"发表评论...",class:"comment-input",rows:"3",maxlength:"140"},null,512),[[Tt,x.value]]),t("div",ks,[t("span",ws,o(x.value.length)+"/140",1),t("button",{onClick:gt,disabled:!x.value.trim()||R.value,class:"send-comment-btn"},[R.value?(i(),c("div",Ms)):(i(),c("span",Ss,"发送"))],8,xs)])]),V.value?(i(),c("div",zs,[...s[14]||(s[14]=[t("div",{class:"spinner"},null,-1)])])):(i(),c("div",Vs,[(i(!0),c(G,null,Q(g.value,r=>(i(),c("div",{key:r.commentId,class:"comment-item"},[t("img",{src:r.user.avatarUrl,class:"comment-avatar"},null,8,Is),t("div",Ps,[t("div",Bs,[t("span",Ds,o(r.user.nickname),1),t("span",Ts,o(yt(r.time)),1)]),t("div",Ls,o(r.content),1),t("div",$s,[t("button",Hs,[s[15]||(s[15]=t("svg",{viewBox:"0 0 24 24",width:"14",height:"14"},[t("path",{fill:"currentColor",d:"M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2z"})],-1)),h(" "+o(r.replyCount||0),1)]),t("button",{class:U(["action-btn-small",{liked:r.liked}]),onClick:zt=>Ct(r)},[s[16]||(s[16]=t("svg",{viewBox:"0 0 24 24",width:"14",height:"14"},[t("path",{fill:"currentColor",d:"M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"})],-1)),h(" "+o(r.likedCount||0),1)],10,Ns),r.user.userId===E(rt).userId?(i(),c("button",{key:0,class:"action-btn-small delete-btn",onClick:zt=>bt(r)},[...s[17]||(s[17]=[t("svg",{viewBox:"0 0 24 24",width:"14",height:"14"},[t("path",{fill:"currentColor",d:"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"})],-1),h(" 删除 ",-1)])],8,Us)):y("",!0)])])]))),128)),g.value.length===0?(i(),c("div",Fs,[...s[18]||(s[18]=[t("svg",{viewBox:"0 0 24 24",width:"60",height:"60"},[t("path",{fill:"currentColor",d:"M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2z"})],-1),t("p",null,"暂无评论，快来抢沙发吧~",-1)])])):y("",!0),K.value?(i(),c("div",Rs,[t("button",{onClick:ft,disabled:V.value,class:"load-more-btn"},[V.value?(i(),c("div",Es)):(i(),c("span",As,"加载更多"))],8,js)])):y("",!0)]))],512),[[ct,f.value==="comments"]]),W(t("div",Js,[t("div",Ks,[t("div",Os,[s[19]||(s[19]=t("div",{class:"detail-label"},"歌单名称",-1)),t("div",qs,o((v=n.value)==null?void 0:v.name),1)]),t("div",Gs,[s[20]||(s[20]=t("div",{class:"detail-label"},"创建者",-1)),t("div",Qs,[t("img",{src:(D=(A=n.value)==null?void 0:A.creator)==null?void 0:D.avatarUrl,class:"creator-avatar"},null,8,Ws),t("span",null,o((L=(T=n.value)==null?void 0:T.creator)==null?void 0:L.nickname),1)])]),t("div",Xs,[s[21]||(s[21]=t("div",{class:"detail-label"},"创建时间",-1)),t("div",Ys,o(O(($=n.value)==null?void 0:$.createTime)),1)]),t("div",Zs,[s[22]||(s[22]=t("div",{class:"detail-label"},"更新时间",-1)),t("div",te,o(O((H=n.value)==null?void 0:H.updateTime)),1)]),t("div",se,[s[23]||(s[23]=t("div",{class:"detail-label"},"歌曲数量",-1)),t("div",ee,o((N=n.value)==null?void 0:N.trackCount)+" 首",1)]),t("div",oe,[s[24]||(s[24]=t("div",{class:"detail-label"},"播放次数",-1)),t("div",ae,o(Y((et=n.value)==null?void 0:et.playCount)),1)]),t("div",le,[s[25]||(s[25]=t("div",{class:"detail-label"},"收藏次数",-1)),t("div",ne,o((ot=n.value)==null?void 0:ot.subscribedCount),1)]),(at=n.value)!=null&&at.description?(i(),c("div",ie,[s[26]||(s[26]=t("div",{class:"detail-label"},"简介",-1)),t("div",ce,o((lt=n.value)==null?void 0:lt.description),1)])):y("",!0),(it=(nt=n.value)==null?void 0:nt.tags)!=null&&it.length?(i(),c("div",re,[s[27]||(s[27]=t("div",{class:"detail-label"},"标签",-1)),t("div",de,[(i(!0),c(G,null,Q(n.value.tags,r=>(i(),c("span",{key:r,class:"tag"},o(r),1))),128))])])):y("",!0)])],512),[[ct,f.value==="details"]])])])])):y("",!0)]}),_:1})])}}},_e=Vt(ue,[["__scopeId","data-v-45753dd1"]]);export{_e as default};
