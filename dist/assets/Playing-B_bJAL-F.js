import{_ as ct,y as dt,u as ut,r as v,g as vt,R as A,M as E,c as o,b as l,d as e,e as ht,I as L,f as u,t as h,n as H,F as G,E as J,w as mt,j as T,z as ft,B as gt,K as pt,T as yt,v as B,x as Ct,L as kt,S as wt}from"./index-BNZe5Fbc.js";const bt={class:"playing-page"},_t={class:"playing-container"},xt={class:"disc-section"},zt=["src"],Mt={class:"song-info"},Lt={class:"song-name"},Ht={class:"song-artist"},Bt={class:"song-album"},Vt={class:"mobile-controls"},St=["disabled"],It={key:0,viewBox:"0 0 24 24",width:"36",height:"36"},Tt={key:1,viewBox:"0 0 24 24",width:"36",height:"36"},Nt=["disabled"],Pt={key:0,viewBox:"0 0 24 24",width:"24",height:"24"},$t={key:1,viewBox:"0 0 24 24",width:"24",height:"24"},Dt={key:2,viewBox:"0 0 24 24",width:"24",height:"24"},Et={class:"song-actions"},Ut={class:"lyric-header"},Rt={key:0,class:"no-lyric"},jt={key:1,class:"lyric-list"},Ft=["onClick"],Kt={class:"drawer-header"},Ot={class:"drawer-body"},qt={class:"comment-input-section"},At={class:"comment-input-footer"},Gt={class:"char-count"},Jt=["disabled"],Qt={key:0},Wt={key:1,class:"spinner-small"},Xt={key:0,class:"loading-comments"},Yt={key:1,class:"comments-list"},Zt=["src"],te={class:"comment-content"},ee={class:"comment-user"},se={class:"username"},oe={class:"comment-time"},le={class:"comment-text"},ne={class:"comment-actions"},ie={class:"action-btn"},re=["onClick"],ae=["onClick"],ce={key:0,class:"empty-comments"},de={key:1,class:"load-more"},ue=["disabled"],ve={key:0},he={key:1,class:"spinner-small"},me={__name:"Playing",setup(fe){const Q=Ct(),W=kt(),i=dt(),X=ut(),N=v(null),U=v([]),P=v(0),V=v(!1),C=v(!1),w=v(!1),g=v([]),b=v(!1),_=v(0),$=v(!0),y=v(""),S=v(!1),{proxy:Y}=vt(),p=Y.$toast,c=A(()=>i.currentSong),Z=()=>{w.value=!w.value};E(()=>W.path,()=>{w.value=!1,C.value=!1});const x=A(()=>{if(!i.lyric)return[];const s=i.lyric.split(`
`),t=[];return s.forEach(n=>{const d=n.match(/\[(\d{2}):(\d{2})\.(\d{2,3})\](.*)/);if(d){const m=parseInt(d[1]),f=parseInt(d[2]),k=parseInt(d[3].padEnd(3,"0")),z=m*60+f+k/1e3,M=d[4].trim();M&&t.push({time:z,text:M})}}),t.sort((n,d)=>n.time-d.time)});E(()=>i.currentTime,s=>{if(x.value.length){for(let t=x.value.length-1;t>=0;t--)if(s>=x.value[t].time){P.value!==t&&(P.value=t,tt(t));break}}});const tt=async s=>{await wt();const t=U.value[s];if(t&&N.value){const n=N.value,d=t.offsetTop,m=n.clientHeight,f=d-m/2+t.clientHeight/2;n.scrollTo({top:f,behavior:"smooth"})}},et=s=>{i.seek(s)},st=async()=>{if(c.value)try{const s=!V.value;(await B.likeSong(c.value.id,s)).code===200&&(V.value=s,p.success(s?"已添加到我喜欢的音乐":"已取消收藏"))}catch(s){console.error("收藏失败:",s),p.error("操作失败，请重试")}},D=async()=>{if(c.value)try{b.value=!0;const s=await B.getSongComment(c.value.id,20,_.value);_.value===0?g.value=s.comments||[]:g.value=[...g.value,...s.comments||[]],$.value=s.more||!1}catch(s){console.error("获取评论失败:",s)}finally{b.value=!1}},ot=()=>{_.value+=20,D()},lt=async()=>{if(!(!y.value.trim()||!c.value))try{S.value=!0;const s=await B.sendComment(0,c.value.id,y.value.trim());s.code===200?(p.success("评论成功"),y.value="",_.value=0,g.value=[],$.value=!0,setTimeout(async()=>{await D()},500)):p.error(s.message||"评论失败")}catch(s){console.error("发送评论失败:",s),p.error("评论失败，请重试")}finally{S.value=!1}},nt=async s=>{if(c.value)try{const t=!s.liked;(await B.likeComment(0,c.value.id,s.commentId,t)).code===200&&(s.liked=t,s.likedCount=t?(s.likedCount||0)+1:Math.max((s.likedCount||0)-1,0))}catch(t){console.error("点赞评论失败:",t),p.error("操作失败，请重试")}},it=async s=>{if(confirm("确定要删除这条评论吗？")&&c.value)try{const t=await B.deleteComment(0,c.value.id,s.commentId);if(t.code===200){p.success("删除成功");const n=g.value.findIndex(d=>d.commentId===s.commentId);n>-1&&g.value.splice(n,1)}else p.error(t.message||"删除失败")}catch(t){console.error("删除评论失败:",t),p.error("删除失败，请重试")}},rt=s=>{const n=Date.now()-s,d=60*1e3,m=60*d,f=24*m,k=30*f;return n<d?"刚刚":n<m?Math.floor(n/d)+"分钟前":n<f?Math.floor(n/m)+"小时前":n<k?Math.floor(n/f)+"天前":new Date(s).toLocaleDateString("zh-CN",{year:"numeric",month:"numeric",day:"numeric"})};E(C,s=>{s&&g.value.length===0&&(_.value=0,D())});const at=()=>{Q.back()};return(s,t)=>{var n,d,m,f,k,z,M,R,j,F,K,O,q;return l(),o("div",bt,[e("div",_t,[e("div",xt,[e("div",{class:"disc-wrapper",onClick:Z},[e("div",{class:L(["disc",{rotating:u(i).playing}])},[t[10]||(t[10]=e("div",{class:"disc-bg"},null,-1)),e("img",{src:((d=(n=c.value)==null?void 0:n.al)==null?void 0:d.picUrl)||((f=(m=c.value)==null?void 0:m.album)==null?void 0:f.picUrl),class:"disc-cover"},null,8,zt),t[11]||(t[11]=e("div",{class:"disc-center"},null,-1))],2),t[12]||(t[12]=e("div",{class:"mobile-hint"},"点击唱片查看歌词",-1))]),e("div",Mt,[e("h1",Lt,h((k=c.value)==null?void 0:k.name),1),e("p",Ht,h(((M=(z=c.value)==null?void 0:z.ar)==null?void 0:M.map(r=>r.name).join(" / "))||((j=(R=c.value)==null?void 0:R.artists)==null?void 0:j.map(r=>r.name).join(" / "))),1),e("p",Bt,"专辑："+h(((K=(F=c.value)==null?void 0:F.al)==null?void 0:K.name)||((q=(O=c.value)==null?void 0:O.album)==null?void 0:q.name)),1),e("div",Vt,[e("button",{class:"control-btn",onClick:t[0]||(t[0]=(...r)=>u(i).playPrev&&u(i).playPrev(...r)),disabled:!u(i).hasPrev},[...t[13]||(t[13]=[e("svg",{viewBox:"0 0 24 24",width:"28",height:"28"},[e("path",{fill:"currentColor",d:"M6 6h2v12H6zm3.5 6l8.5 6V6z"})],-1)])],8,St),e("button",{class:"control-btn play-btn",onClick:t[1]||(t[1]=(...r)=>u(i).togglePlay&&u(i).togglePlay(...r))},[u(i).playing?(l(),o("svg",Tt,[...t[15]||(t[15]=[e("path",{fill:"currentColor",d:"M6 4h4v16H6V4zm8 0h4v16h-4V4z"},null,-1)])])):(l(),o("svg",It,[...t[14]||(t[14]=[e("path",{fill:"currentColor",d:"M8 5v14l11-7z"},null,-1)])]))]),e("button",{class:"control-btn",onClick:t[2]||(t[2]=(...r)=>u(i).playNext&&u(i).playNext(...r)),disabled:!u(i).hasNext},[...t[16]||(t[16]=[e("svg",{viewBox:"0 0 24 24",width:"28",height:"28"},[e("path",{fill:"currentColor",d:"M16 18h2V6h-2v12zM6 18l8.5-6L6 6v12z"})],-1)])],8,Nt),e("button",{class:"control-btn mode-btn",onClick:t[3]||(t[3]=(...r)=>u(i).toggleMode&&u(i).toggleMode(...r))},[u(i).mode==="list"?(l(),o("svg",Pt,[...t[17]||(t[17]=[e("path",{fill:"currentColor",d:"M7 7h10v2H7V7zm0 4h10v2H7v-2zm0 4h10v2H7v-2z"},null,-1)])])):u(i).mode==="random"?(l(),o("svg",$t,[...t[18]||(t[18]=[e("path",{fill:"currentColor",d:"M10.59 9.17L5.41 4 4 5.41l5.17 5.17 1.42-1.41zM14.5 4l2.04 2.04L4 18.59 5.41 20 17.96 7.46 20 9.5V4h-5.5zm.33 9.41l-1.41 1.41 3.13 3.13L14.5 20H20v-5.5l-2.04 2.04-3.13-3.13z"},null,-1)])])):(l(),o("svg",Dt,[...t[19]||(t[19]=[e("path",{fill:"currentColor",d:"M7 7h10v3l4-4-4-4v3H5v6h2V7zm10 10H7v-3l-4 4 4 4v-3h12v-6h-2v4z"},null,-1)])]))])]),e("div",Et,[e("button",{class:L(["action-button",{liked:V.value}]),onClick:st},[t[20]||(t[20]=e("svg",{viewBox:"0 0 24 24",width:"18",height:"18",fill:"currentColor"},[e("path",{d:"M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"})],-1)),H(" "+h(V.value?"已收藏":"收藏"),1)],2),e("button",{class:"action-button",onClick:t[4]||(t[4]=r=>C.value=!0)},[...t[21]||(t[21]=[e("svg",{viewBox:"0 0 24 24",width:"18",height:"18",fill:"currentColor"},[e("path",{d:"M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2z"})],-1),H(" 评论 ",-1)])])])])]),e("div",{class:L(["lyric-section",{"show-mobile":w.value}])},[e("div",Ut,[t[23]||(t[23]=e("svg",{viewBox:"0 0 24 24",width:"24",height:"24"},[e("path",{fill:"currentColor",d:"M12 3v9.28c-.47-.17-.97-.28-1.5-.28C8.01 12 6 14.01 6 16.5S8.01 21 10.5 21c2.31 0 4.2-1.75 4.45-4H15V6h4V3h-7z"})],-1)),t[24]||(t[24]=e("span",null,"歌词",-1)),e("button",{class:"close-lyric-btn",onClick:t[5]||(t[5]=r=>w.value=!1)},[...t[22]||(t[22]=[e("svg",{viewBox:"0 0 24 24",width:"24",height:"24"},[e("path",{fill:"currentColor",d:"M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"})],-1)])])]),e("div",{ref_key:"lyricScrollbar",ref:N,class:"lyric-container"},[x.value.length?(l(),o("div",jt,[(l(!0),o(G,null,J(x.value,(r,a)=>(l(),o("div",{key:a,ref_for:!0,ref:I=>U.value[a]=I,class:L(["lyric-line",{active:a===P.value}]),onClick:I=>et(r.time)},h(r.text),11,Ft))),128))])):(l(),o("div",Rt,[...t[25]||(t[25]=[e("svg",{viewBox:"0 0 24 24",width:"60",height:"60"},[e("path",{fill:"currentColor",d:"M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6zm2 16H8v-2h8v2zm0-4H8v-2h8v2zm-3-5V3.5L18.5 9H13z"})],-1),e("p",null,"暂无歌词",-1)])]))],512)],2)]),e("button",{onClick:at,class:"back-btn"},[...t[26]||(t[26]=[e("svg",{viewBox:"0 0 24 24",width:"24",height:"24"},[e("path",{fill:"currentColor",d:"M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"})],-1)])]),ht(yt,{name:"drawer"},{default:mt(()=>{var r;return[C.value?(l(),o("div",{key:0,class:"drawer-overlay",onClick:t[9]||(t[9]=a=>C.value=!1)},[e("div",{class:"drawer-container",onClick:t[8]||(t[8]=pt(()=>{},["stop"]))},[e("div",Kt,[e("h3",null,h((r=c.value)==null?void 0:r.name)+" - 评论",1),e("button",{class:"close-btn",onClick:t[6]||(t[6]=a=>C.value=!1)},[...t[27]||(t[27]=[e("svg",{viewBox:"0 0 24 24",width:"24",height:"24"},[e("path",{fill:"currentColor",d:"M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"})],-1)])])]),e("div",Ot,[e("div",qt,[ft(e("textarea",{"onUpdate:modelValue":t[7]||(t[7]=a=>y.value=a),placeholder:"发表评论...",class:"comment-input",rows:"3",maxlength:"140"},null,512),[[gt,y.value]]),e("div",At,[e("span",Gt,h(y.value.length)+"/140",1),e("button",{onClick:lt,disabled:!y.value.trim()||S.value,class:"send-comment-btn"},[S.value?(l(),o("div",Wt)):(l(),o("span",Qt,"发送"))],8,Jt)])]),b.value?(l(),o("div",Xt,[...t[28]||(t[28]=[e("div",{class:"spinner"},null,-1)])])):(l(),o("div",Yt,[(l(!0),o(G,null,J(g.value,a=>(l(),o("div",{key:a.commentId,class:"comment-item"},[e("img",{src:a.user.avatarUrl,class:"comment-avatar"},null,8,Zt),e("div",te,[e("div",ee,[e("span",se,h(a.user.nickname),1),e("span",oe,h(rt(a.time)),1)]),e("div",le,h(a.content),1),e("div",ne,[e("button",ie,[t[29]||(t[29]=e("svg",{viewBox:"0 0 24 24",width:"14",height:"14"},[e("path",{fill:"currentColor",d:"M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2z"})],-1)),H(" "+h(a.replyCount||0),1)]),e("button",{class:L(["action-btn",{liked:a.liked}]),onClick:I=>nt(a)},[t[30]||(t[30]=e("svg",{viewBox:"0 0 24 24",width:"14",height:"14"},[e("path",{fill:"currentColor",d:"M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"})],-1)),H(" "+h(a.likedCount||0),1)],10,re),a.user.userId===u(X).userId?(l(),o("button",{key:0,class:"action-btn delete-btn",onClick:I=>it(a)},[...t[31]||(t[31]=[e("svg",{viewBox:"0 0 24 24",width:"14",height:"14"},[e("path",{fill:"currentColor",d:"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"})],-1),H(" 删除 ",-1)])],8,ae)):T("",!0)])])]))),128)),g.value.length===0?(l(),o("div",ce,[...t[32]||(t[32]=[e("svg",{viewBox:"0 0 24 24",width:"60",height:"60"},[e("path",{fill:"currentColor",d:"M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2z"})],-1),e("p",null,"暂无评论，快来抢沙发吧~",-1)])])):T("",!0),$.value?(l(),o("div",de,[e("button",{onClick:ot,disabled:b.value,class:"load-more-btn"},[b.value?(l(),o("div",he)):(l(),o("span",ve,"加载更多"))],8,ue)])):T("",!0)]))])])])):T("",!0)]}),_:1})])}}},pe=ct(me,[["__scopeId","data-v-bf5eff6e"]]);export{pe as default};
