import{_ as Y,u as R,r as b,g as S,U as G,o as A,x as E,c as J,b as L,d as i,e as t,n as m,w as l,f as k,s as T,i as u,V as W,v as x}from"./index-BNZe5Fbc.js";const $={class:"profile"},j={class:"container"},q={class:"profile-header"},H={class:"page-title"},K={class:"profile-content glass"},O={class:"avatar-section"},Q={class:"avatar-wrapper"},X={__name:"Profile",setup(Z){const g=E(),p=R(),_=b(null),I=b(null),v=b(!1),{proxy:C}=S(),s=C.$toast,a=G({nickname:"",gender:0,birthday:null,signature:""}),U=()=>{var e;const o=(e=p.userInfo)==null?void 0:e.profile;o&&(a.nickname=o.nickname||"",a.gender=o.gender||0,a.birthday=o.birthday||null,a.signature=o.signature||"")},z=()=>{var o;(o=_.value)==null||o.click()},D=async o=>{var f;const e=(f=o.target.files)==null?void 0:f[0];if(e){if(!e.type.startsWith("image/")){s.error("请选择图片文件");return}if(e.size>5*1024*1024){s.error("图片大小不能超过 5MB");return}try{const d=new FormData;d.append("imgFile",e),s.info("正在上传头像...",0);const n=await x.uploadAvatar(d);n.code===200?(s.success("头像更新成功"),await p.fetchUserInfo()):s.error(n.message||"头像更新失败")}catch(d){console.error("上传头像失败:",d),s.error("头像上传失败，请重试")}finally{_.value&&(_.value.value="")}}},F=async()=>{var o,e,f,d;try{v.value=!0;const n={nickname:a.nickname,gender:a.gender,birthday:a.birthday,signature:a.signature},r=await x.updateProfile(n);r.code===200?(s.success("个人资料更新成功"),await p.fetchUserInfo(),g.back()):s.error(r.msg||r.message||"更新失败")}catch(n){console.error("更新个人资料失败:",n);const r=((e=(o=n.response)==null?void 0:o.data)==null?void 0:e.msg)||((d=(f=n.response)==null?void 0:f.data)==null?void 0:d.message)||"更新失败，请重试";s.error(r)}finally{v.value=!1}},M=()=>{g.back()};return A(()=>{if(!p.isLoggedIn){s.warning("请先登录"),g.push("/login");return}U()}),(o,e)=>{var w,h;const f=u("el-icon"),d=u("el-avatar"),n=u("el-input"),r=u("el-form-item"),y=u("el-radio"),P=u("el-radio-group"),B=u("el-date-picker"),V=u("el-button"),N=u("el-form");return L(),J("div",$,[i("div",j,[i("div",q,[i("h1",H,[t(f,null,{default:l(()=>[t(k(T))]),_:1}),e[4]||(e[4]=m(" 个人资料 ",-1))])]),i("div",K,[i("div",O,[i("div",Q,[t(d,{size:120,src:(h=(w=k(p).userInfo)==null?void 0:w.profile)==null?void 0:h.avatarUrl},null,8,["src"]),i("div",{class:"avatar-overlay",onClick:z},[t(f,{size:30},{default:l(()=>[t(k(W))]),_:1}),e[5]||(e[5]=i("span",null,"更换头像",-1))])]),i("input",{ref_key:"fileInput",ref:_,type:"file",accept:"image/*",style:{display:"none"},onChange:D},null,544),e[6]||(e[6]=i("p",{class:"avatar-tip"},"支持 JPG、PNG 格式，建议使用方形图片",-1))]),t(N,{ref_key:"formRef",ref:I,model:a,"label-width":"100px",class:"profile-form"},{default:l(()=>[t(r,{label:"昵称"},{default:l(()=>[t(n,{modelValue:a.nickname,"onUpdate:modelValue":e[0]||(e[0]=c=>a.nickname=c),placeholder:"请输入昵称",maxlength:"20","show-word-limit":""},null,8,["modelValue"])]),_:1}),t(r,{label:"性别"},{default:l(()=>[t(P,{modelValue:a.gender,"onUpdate:modelValue":e[1]||(e[1]=c=>a.gender=c)},{default:l(()=>[t(y,{value:0},{default:l(()=>[...e[7]||(e[7]=[m("保密",-1)])]),_:1}),t(y,{value:1},{default:l(()=>[...e[8]||(e[8]=[m("男",-1)])]),_:1}),t(y,{value:2},{default:l(()=>[...e[9]||(e[9]=[m("女",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),t(r,{label:"生日"},{default:l(()=>[t(B,{modelValue:a.birthday,"onUpdate:modelValue":e[2]||(e[2]=c=>a.birthday=c),type:"date",placeholder:"选择日期",format:"YYYY-MM-DD","value-format":"x"},null,8,["modelValue"])]),_:1}),t(r,{label:"个性签名"},{default:l(()=>[t(n,{modelValue:a.signature,"onUpdate:modelValue":e[3]||(e[3]=c=>a.signature=c),type:"textarea",rows:4,placeholder:"写点什么介绍一下自己吧...",maxlength:"200","show-word-limit":""},null,8,["modelValue"])]),_:1}),t(r,null,{default:l(()=>[t(V,{type:"danger",size:"large",onClick:F,loading:v.value,round:""},{default:l(()=>[...e[10]||(e[10]=[m(" 保存修改 ",-1)])]),_:1},8,["loading"]),t(V,{size:"large",onClick:M,round:""},{default:l(()=>[...e[11]||(e[11]=[m(" 取消 ",-1)])]),_:1})]),_:1})]),_:1},8,["model"])])])])}}},te=Y(X,[["__scopeId","data-v-d363b1e1"]]);export{te as default};
